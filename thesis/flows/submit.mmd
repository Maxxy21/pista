%% Pitch Submission (styled, Q&A required)
flowchart TB
  subgraph subGraph3["Pitch Creation"]
    Dashboard["Dashboard"]
    PitchForm["Pitch Creation Form"]
    ContentType["Select: Text | Audio | Text File"]
    AudioUpload["Audio Upload"]
    Transcribe["/api/transcribe (audio â†’ text)"]
    TextReady["Pitch Text Ready"]
    GenQuestions["/api/generate-questions"]
    AnswerQA["Answer up to 3 Questions"]
    Review["Review"]
    Evaluate["/api/evaluate (text + Q&A)"]
    CreatePitch["Save Pitch (convex.pitches.create)"]
    PitchList["List of Pitches"]
  end

  subgraph subGraph6["Database Operations"]
    Convex[("Convex Database")]
  end

  subgraph subGraph8["Pitch Details"]
    PitchDetails["Pitch Details View (/pitch/:id)"]
    Score["Overall Score"]
    Breakdown["Criteria Breakdown"]
    Suggestions["Improvement Suggestions"]
  end

  Dashboard -- Create New --> PitchForm
  PitchForm --> ContentType
  ContentType -->|Text| TextReady
  ContentType -->|Text File| TextReady
  ContentType -->|Audio| AudioUpload --> Transcribe --> TextReady
  TextReady --> GenQuestions --> AnswerQA --> Review --> Evaluate --> CreatePitch
  CreatePitch --> PitchList
  PitchList -- Select --> PitchDetails
  PitchDetails -- View --> Score & Breakdown & Suggestions
  PitchDetails -- Edit --> PitchForm

  %% DB reads/writes (dashed)
  PitchList -. Read .-> Convex
  CreatePitch -. Write .-> Convex

  classDef landingNode fill:#f3e5f5,stroke:#9c27b0
  classDef authNode fill:#e1f5fe,stroke:#0288d1
  classDef mainNode fill:#f3e5f5,stroke:#7b1fa2
  classDef aiNode fill:#fff3e0,stroke:#ff9800
  classDef openaiNode fill:#fce4ec,stroke:#e91e63
  classDef dbNode fill:#e8f5e9,stroke:#388e3c
  classDef displayNode fill:#f1f8e9,stroke:#689f38

  class Dashboard,PitchForm,ContentType,AudioUpload,Transcribe,TextReady,GenQuestions,AnswerQA,Review,Evaluate,CreatePitch,PitchList mainNode
  class Convex dbNode
  class PitchDetails,Score,Breakdown,Suggestions displayNode

  style Convex fill:#FFD600
  style subGraph6 fill:none
